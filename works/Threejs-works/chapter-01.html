<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>chapter-01</title>
	<script type="text/javascript" src="./js/jquery-3.1.0.js"></script>
	<script type="text/javascript" src="./js/three.js"></script>
	<script type="text/javascript" src="./js/stats.min.js"></script>
	<script type="text/javascript" src="./js/dat.gui.js"></script>
	<script type="text/javascript" src="./js/Tween.js"></script>
	<style>
		body{
			margin: 0;
			overflow: hidden;
		}
	</style>
</head>
<body>
	<div id="Stat-output"></div>
	<div id="canvas">
		
	</div>
	<script type="text/javascript">


		function initStats(){
			var stats = new Stats();
			stats.setMode(0);
			stats.domElement.style.position = 'absolute';
			stats.domElement.style.left = '0px';
			stats.domElement.style.top = '0px';
			$('#canvas').append( stats.domElement );
			return stats;
		}


		$(function(){
			var scene = new THREE.Scene();
			// scene.fog = new THREE.Fog( 0xffffff, 0.015, 80);
			scene.fog = new THREE.FogExp2( 0xffffff, 0.02);
			var camera = new THREE.PerspectiveCamera(45,window.innerWidth / window.innerHeight, 0.1 , 1000);

			var renderer = new THREE.WebGLRenderer();
			renderer.setClearColor(0xEEEEEE, 1.0);
			renderer.setSize(window.innerWidth, window.innerHeight);
			// renderer.shadowMapEnabled = true;

			var axes = new THREE.AxisHelper( 20 );
			scene.add(axes);

			var stats = initStats();



			var planeGeometry = new THREE.PlaneGeometry(60,40,1,1);
			var planeMaterial = new THREE.MeshLambertMaterial({color:0x000000});
			
			var plane = new THREE.Mesh(planeGeometry,planeMaterial);
			plane.rotation.x = -0.5*Math.PI;
			plane.receiveShadow = true;


			scene.add(plane);

			
			var ambientLight = new THREE.AmbientLight(0xcccccc);
			scene.add(ambientLight);

			var spotLight = new THREE.SpotLight(0xffffff);
			spotLight.position.set( -30, 50, -20 );
			// spotLight.castShadow = true;
			scene.add( spotLight );	


			var  controls = new function() {
				this.rotationSpeed    	= 0.02;
				this.addCube = function() {
					var cubeSize = Math.ceil(Math.random() * 3 );
					var cubeGeometry = new THREE.CubeGeometry(cubeSize,cubeSize,cubeSize);
					var cubeMaterial = new THREE.MeshLambertMaterial({color: 0x000000 });
					var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
					cube.castShadow = true;
					cube.name = "cube-" + scene.children.length;
					cube.position.x = -30 + Math.round(Math.random() * planeGeometry.parameters.width);
					cube.position.y = Math.round(Math.random() * 5);
					cube.position.z = -20 + Math.round(Math.random() * planeGeometry.parameters.height);
					scene.add(cube);

					// var tween = new TWEEN.Tween(cube.position)
					// 			 .to({ y: 20 }, 5000)
					// 			 .repeat(Infinity)
					// 			 .start()


					this.numberOfObjects = scene.children.length;
					console.log(cube);
				};
				this.addSphere = function() {
					var sphereRadius = Math.ceil(Math.random() * 1);
					var sphereWidSegments = 20;
					var sphereHeiSegments  = 20;
					var sphereGeometry = new THREE.SphereGeometry(sphereRadius, sphereWidSegments, sphereHeiSegments);
					var sphereMaterial = new THREE.MeshLambertMaterial({color: 0x000000});
					var sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
					sphere.castShadow = true;
					sphere.name = "sphere-" + scene.children.length;
					sphere.position.x = -30 + Math.round(Math.random() * planeGeometry.parameters.width);
					sphere.position.y = Math.round(Math.random()*5);
					sphere.position.z = -20 + Math.round(Math.random() * planeGeometry.parameters.height);
					scene.add(sphere);

					var tween = new TWEEN.Tween(sphere.position)
								.to({ y:40 }, 5000)
								.repeat(Infinity)
								.start()

					this.numberOfObjects = scene.children.length;
				}
				this.remove = function() {
					var allChildren = scene.children;
					var lastObject  = allChildren[allChildren.length-1];
					if(lastObject instanceof THREE.Mesh) {
						scene.remove(lastObject);
						this.numberOfObjects = scene.children.length;
					}
				};
				this.outputObject = function() {
					console.log(scene.children);

				};
			}


			var gui = new dat.GUI( );
			gui.add(controls, 'rotationSpeed',0,0.5);
			gui.add(controls, 'addCube');
			gui.add(controls, 'addSphere');
			gui.add(controls, 'remove');
			gui.add(controls, 'outputObject');

			function renderScene() {
				stats.update();


				scene.traverse(function(e) {
					if(e instanceof THREE.Mesh && e != plane) {
						e.rotation.x += controls.rotationSpeed;
						e.rotation.y += controls.rotationSpeed;
						e.rotation.z += controls.rotationSpeed;
					}
				})

				TWEEN.update();

				requestAnimationFrame(renderScene);
				renderer.render(scene, camera);
			}

			camera.position.x = -40;
			camera.position.y = 40;
			camera.position.z = 30;
			camera.lookAt(scene.position);


			$("#canvas").append(renderer.domElement);
			renderScene();
		})
	</script>
</body>
</html>